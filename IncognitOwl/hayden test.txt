clearColor = [0.5,0.5,0.5,1];
use2D = true;
initGame("canvas");
var ctx = canvas.getContext("2d");

gInput.addBool(38, "e_up");
gInput.addBool(40, "e_down");
gInput.addBool(37, "e_left");
gInput.addBool(39, "e_right");

gInput.addBool(87, "p_up");
gInput.addBool(83, "p_down");
gInput.addBool(65, "p_left");
gInput.addBool(68, "p_right");

function check_collision(bx, by) {
    if (bx > 119 && bx < 521 && by > 81 && by < 119){
        return true;
    }
    return false;
}

var player = new Sprite();
player.x = 600;
player.y = 500;
player.width = 25;
player.height = 38;
player.xoffset = -player.width/2;
player.yoffset = -player.height/2;
player.image = Textures.load("http://www.jar42.com/brine/vision_test/images/bear.png");
world.addChild(player);
player.speed = 1;
player.update = function(d){
    if(gInput.e_up){
        this.y -= this.speed;
    }
    if(gInput.e_down){
        this.y += this.speed;
    }
    if(gInput.e_left){
        this.x -= this.speed;
    }
    if(gInput.e_right){
        this.x += this.speed;
    }
    guard.angry = false;
    if(check_collision(this.x, this.y)){
        light.image = Textures.load("http://yobananaboy.com/imagemade/2995each.gif");
    }
}

var guard = new Sprite();
guard.x = 100;
guard.y = 100;
guard.width = 36;
guard.height = 36;
guard.xoffset = -guard.width/2;
guard.yoffset = -guard.height/2;
guard.image = Textures.load("http://www.jar42.com/brine/vision_test/images/bigme.png");
world.addChild(guard);
guard.angry = false;
guard.face = "right";
guard.speed = 1;
guard.update = function(ctx){
    if(gInput.p_up){
        this.y -= this.speed;
    }
    if(gInput.p_down){
        this.y += this.speed;
    }
    if(gInput.p_left){
        this.x -= this.speed;
    }
    if(gInput.p_right){
        this.x += this.speed;
    }
       
}

var light = new Sprite();
light.x = guard.x - guard.xoffset;
light.y = guard.y + guard.yoffset;
light.width = 400;
light.height = 36;
light.image = Textures.load("http://www.belgianshop.com/massmail/BudLight400.jpg");
world.addChild(light);
light.update = function(d){
    if(gInput.p_up){
        light.x = guard.x + guard.xoffset;
        light.y = guard.y + guard.yoffset;
        light.width = 36;
        light.height = -400;
    }
    if(gInput.p_down){
        light.x = guard.x + guard.xoffset;
        light.y = guard.y - guard.yoffset;
        light.width = 36;
        light.height = 400;
    }
    if(gInput.p_left){
        light.x = guard.x + guard.xoffset;
        light.y = guard.y + guard.yoffset;
        light.width = -400;
        light.height = 36;
    }
    if(gInput.p_right){
        light.x = guard.x - guard.xoffset;
        light.y = guard.y + guard.yoffset;
        light.width = 400;
        light.height = 36;
    }
}    

world.draw = function(ctx){
    this.drawChildren(ctx);
    
    ctx.fillStyle = "green";
    if(guard.angry){
        ctx.fillStyle = "red";
    }

    ctx.fillText(player.x, 10, 10);
    ctx.fillText(player.y, 10, 20);
}

world.update = function(d){
    this.updateChildren(d);
}
